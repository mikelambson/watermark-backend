generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema", "postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["config", "auth",  "legacy", "maint", "ops", "analysis", "public", "timeseries"]
  extensions = [pgcrypto]
}

model Users {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  login        String   @unique @db.VarChar
  password     String   @db.VarChar
  fullname     String?  @db.VarChar
  email        String?  @db.VarChar
  title        String?  @default("user") @db.VarChar
  tcid_staff   Boolean? @default(false)
  protected    Boolean  @default(false)
  active       Boolean  @default(true)
  roleId       UserRoles[]

  @@schema("auth")
}

model Roles {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String   @unique @db.VarChar
  users       UserRoles[]
  
  @@schema("auth")
}

model UserRoles {
  user        Users @relation(fields: [userId], references: [id])
  userId      String @db.Uuid
  role        Roles @relation(fields: [roleId], references: [id])
  roleId      String @db.Uuid
  assignedAt  DateTime @default(now())
  assignedBy  String

  @@id([userId, roleId])

  @@schema("auth")
}

model LegacyOrders {
  id              Int       @id @default(autoincrement())
  orderTimestamp  DateTime?
  irrigatorsName  String?
  ownersName      String?
  name            String?
  phoneNumber     String?
  phoneNumber2    String?
  phoneNumber3    String?
  lateral1        String
  lateral2        String?
  lateral3        String?
  lateral4        String?
  approxCfs       Float?
  approxHrs       Float?
  orderNumber     Int @unique
  tcidSn          String
  remarks         String?
  approxAf        Float?
  balance         Float?
  district        String?
  adjust          String
  scheduled       Boolean @default(false)

  @@schema("legacy")
  @@index([adjust], name: "adjust_index")
  @@index([orderTimestamp], name: "order_timestamp_index")
  @@index([orderNumber], name: "order_number_index")
  @@index([tcidSn], name: "tcid_sn_index")
}